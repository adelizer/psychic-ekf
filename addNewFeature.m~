function [xEst, covest] = addNewFeature(xEst, covEst, z, iFeature)
%addNewFeature(xEst, covEst) Summary of this function goes here
%   Detailed explanation goes here
global mappedLandFeatures;
%%
n = length(xEst);
x = xEst(1);
y = xEst(2);
theta = xEst(3);
range = z(1);
bearing = z(2);

% project the location of the landmark into the global frame
newX = x + range * cos(theta + bearing);
newY = y + range * sin(theta + bearing);
xEst = [xEst;new_x;new_y];
mappedLandFeatures(iFeature,:) = [newX, newY];

jGx = [ 1   0   -r*sin(theta + bearing);
    0   1   r*cos(theta + bearing)];
jGz = [ cos(theta + bearing) -r*sin(theta + bearing);
    sin(theta + bearing) r*cos(theta + bearing)];

M = [eye(n), zeros(n,2);% no use jacobian w.r.t vehicle
    jGxv zeros(2,n-3)  , jGz];

covEst = M*blkdiag(covPred,RTrue)*M';
for j=1:4
    if(view_order(j) == -1)
        view_order(j) = iFeature;
        break;
    end
end
end

